<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Password | Music Library Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../CSS/newPassword.css">
</head>
<body>
    <main class="main-content">
        <div class="auth-container">
            <div class="auth-card">
                <i class="fas fa-key auth-icon"></i>
                <h1 class="auth-title">Create New Password</h1>
                
                <div id="statusMessage" class="status-message"></div>
                
                <form id="newPasswordForm">
                    <div class="form-group">
                        <label for="newPassword" class="form-label">New Password</label>
                        <div class="password-field">
                            <input type="password" id="newPassword" class="form-input" placeholder="Enter new password" required>
                            <i class="fas fa-eye password-toggle" id="toggleNewPassword"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                        <div class="password-field">
                            <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password" required>
                            <i class="fas fa-eye password-toggle" id="toggleConfirmPassword"></i>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        Reset Password
                    </button>
                </form>
            </div>
        </div>
    </main>

    <script src="../JS/config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggleNewPassword = document.getElementById('toggleNewPassword');
            const newPassword = document.getElementById('newPassword');
            
            toggleNewPassword.addEventListener('click', function() {
                const type = newPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                newPassword.setAttribute('type', type);
                
                // Toggle eye icon
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
            
            // Toggle password visibility for confirm password field
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const confirmPassword = document.getElementById('confirmPassword');
            
            toggleConfirmPassword.addEventListener('click', function() {
                const type = confirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                confirmPassword.setAttribute('type', type);
                
                // Toggle eye icon
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
            
            // Form submission handling (optional)
            const form = document.getElementById('newPasswordForm');
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (newPassword.value !== confirmPassword.value) {
                    showStatusMessage('Passwords do not match', 'error');
                    return;
                }
                try{    
                    const email=localStorage.getItem("email");
                    const formData={
                        email:email,
                        newPassword:newPassword.value
                    }
                    const response = await fetch(`${window.API_CONFIG.USER}/reset-password`,{
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                    });
                    if(response.ok)
                    {
                        showStatusMessage('Password reset successfully!', 'success');
                        localStorage.removeItem('email');
                        setTimeout(()=>{
                            window.location.href="signUp.html";
                        },1000)
                    }
                    else{
                        errorMessage=(await response.text() || 'Fail!');
                        throw new Error(errorMessage)
                    }  
            }   
            catch(errorMessage){
                showStatusMessage(errorMessage.message,'error');
            }
            });
            
            function showStatusMessage(message, type) {
                const statusElement = document.getElementById('statusMessage');
                statusElement.textContent = message;
                statusElement.style.display = 'block';
                statusElement.style.backgroundColor = type === 'error' ? '#ffebee' : '#e8f5e9';
                statusElement.style.color = type === 'error' ? '#c62828' : '#2e7d32';
            }
        });
    </script>
</body>
</html>